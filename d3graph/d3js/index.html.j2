<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>

    {{ SUPPORT }}

    <style type="text/css">
        {% include "style.css" %}
        .dark-mode {
            background-color: #222 !important;
            color: #eee !important;
        }
        .dark-mode svg {
            background-color: #222 !important;
        }
        .dark-mode .button-switch {
            background: #333;
            color: #eee;
            border: 1px solid #555;
        }
        .button-switch {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            padding: 6px 16px;
            border-radius: 6px;
            border: 1px solid #ccc;
            background: #fff;
            color: #222;
            cursor: pointer;
        }
    </style>
</head>
<body style="background-color: {{ background_color }};{% if dark_mode %} color: #eee;{% endif %}"{% if dark_mode %} class="dark-mode"{% endif %}>

<!-- Dark mode switch -->
<button id="darkModeSwitch" class="button-switch">{% if dark_mode %}‚òÄÔ∏è Light Mode{% else %}üåô Dark Mode{% endif %}</button>

<!-- Create save button -->
{{ save_button_comment_start }}
    <div style="max-width:{{ width }}px;">
        <center><button id="saveButton">Save</button></center>
    </div>
{{ save_button_comment_stop }}


    <script>
        {% include "d3.v3.js" %}
        {% include "d3graphscript.js" %}

        graph = {{ json_data }}

        window.addEventListener('DOMContentLoaded', function () {
            d3graphscript({
                width: {{ width }},
                height: {{ height }},
                charge: {{ charge }},
                distance: {{ edge_distance }},
                directed: {{ directed | lower }},
                collision: {{ collision }},
                background_color: '{{ background_color }}'
            })
        });

        // Dark mode toggle logic
        const darkSwitch = document.getElementById('darkModeSwitch');
        let darkMode = {{ 'true' if dark_mode else 'false' }};
        let originalBg = document.body.style.backgroundColor;
        function setDarkMode(on) {
            if (on) {
                document.body.classList.add('dark-mode');
                document.body.style.backgroundColor = '#222';
                document.body.style.color = '#eee';
                let svg = document.querySelector('svg');
                if (svg) svg.style.backgroundColor = '#222';
                darkSwitch.textContent = '‚òÄÔ∏è Light Mode';
            } else {
                document.body.classList.remove('dark-mode');
                document.body.style.backgroundColor = originalBg;
                document.body.style.color = '';
                let svg = document.querySelector('svg');
                if (svg) svg.style.backgroundColor = originalBg;
                darkSwitch.textContent = 'üåô Dark Mode';
            }
        }
        // Set initial mode
        setDarkMode(darkMode);
        darkSwitch.addEventListener('click', function () {
            darkMode = !darkMode;
            setDarkMode(darkMode);
        });

        // Save image to svg
        document.getElementById('saveButton').addEventListener('click', function () {
            var svgData = document.querySelector('svg').outerHTML;
            var blob = new Blob([svgData], {type: "image/svg+xml;charset=utf-8"});
            var url = URL.createObjectURL(blob);
            var link = document.createElement('a');
            link.href = url;
            link.download = '{{ title }}.svg';
            link.click();
        });
        
        
    </script>



<!-- SLIDER -->
{{ slider_comment_start }}

    {% if max_slider > min_slider %}
	<div style="max-width:{{ width }}px;">
        <form>
            <h3>
                Edge Threshold
                {{ min_slider }}
                <input type="range" autocomplete="off" id="thresholdSlider" value="{{ min_slider }}" min="{{ min_slider }}" max="{{ max_slider }}">
                {{ max_slider }}
            </h3>
        </form>
	</div>
    {% endif %}

{{ slider_comment_stop }}

</body>
</html>

